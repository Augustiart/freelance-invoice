<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Freelance Invoice Generator</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family:'Inter',sans-serif;
  background:radial-gradient(circle at top,#0f0f0f,#020617);
  min-height:100vh;
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:20px;
  color:#e5e7eb;
}
.card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(18px);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:20px;
  padding:40px;
  width:100%;
  max-width:460px;
}
label{display:block;margin-top:14px;font-size:13px;color:#94a3b8}
input,select{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:12px;
  border:1px solid #1e293b;
  background:#020617;
  color:#fff;
}
.row{display:flex;gap:40px;align-items:flex-end}
.date{font-size:12px;color:#94a3b8;white-space:nowrap;padding-bottom:10px}
.project{display:flex;gap:8px;margin-top:10px}
.project input{flex:1}
.qty{max-width:70px}

/* checkbox */
.dp-check{
  display:flex;
  align-items:center;
  gap:12px;
  margin-top:18px;
  cursor:pointer;
}
.dp-check input{
  appearance:none;
  width:18px;
  height:18px;
  border-radius:5px;
  border:2px solid #475569;
  background:#020617;
  position:relative;
}
.dp-check input:checked{
  background:#22c55e;
  border-color:#22c55e;
}
.dp-check input:checked::after{
  content:"";
  position:absolute;
  width:4px;
  height:8px;
  border:solid #022c22;
  border-width:0 2px 2px 0;
  top:50%;
  left:50%;
  transform:translate(-50%,-55%) rotate(45deg);
}

.btn-outline{
  margin-top:12px;
  width:100%;
  padding:12px;
  background:none;
  border:1px dashed #ef4444;
  border-radius:14px;
  color:#ef4444;
  font-weight:600;
}
.summary{margin-top:18px;font-size:14px}
.summary div{display:flex;justify-content:space-between;margin-top:8px}
.green{color:#22c55e;font-weight:600}
.total-final{font-size:18px;font-weight:700;margin-top:12px}
.btn-primary{
  margin-top:22px;
  width:100%;
  padding:14px;
  background:linear-gradient(135deg,#ef4444,#dc2626);
  border:none;
  border-radius:16px;
  color:#fff;
  font-weight:700;
}

/* ===== PDF ===== */
#invoice{
  width:800px;
  background:#ffffff;
  color:#000;
  padding:40px;
  position:absolute;
  left:-9999px;
}
.pdf-row{display:flex;justify-content:space-between}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{border-bottom:1px solid #ddd;padding:8px}
th{background:#f3f3f3}
.pdf-summary{
  margin-top:20px;
  display:flex;
  justify-content:flex-end;
}
.pdf-summary > div{width:320px}
.pdf-summary div div{
  display:flex;
  justify-content:space-between;
  margin-top:6px;
}
</style>
</head>

<body>

<div class="card">
  <h2 style="text-align:center">Invoice Generator</h2>

  <label>Nama Client</label>
  <input id="client">

  <label>Nama Freelancer</label>
  <input id="freelancer">

  <div class="row">
    <div><label>No. Rekening</label><input id="rekening"></div>
    <div><label>Nama Bank</label><input id="bank"></div>
  </div>

  <div class="row">
    <div style="flex:1">
      <label>Zona Waktu</label>
      <select id="tz">
        <option value="7">WIB</option>
        <option value="8">WITA</option>
        <option value="9">WIT</option>
      </select>
    </div>
    <div class="date" id="date"></div>
  </div>

  <label>Project</label>
  <div id="projects"></div>
  <button class="btn-outline" onclick="addProject()">+ Tambah Project</button>

  <label class="dp-check">
    <input type="checkbox" id="useDP">
    <span>Checklist jika sudah DP</span>
  </label>

  <div id="dpOptions" style="display:none">
    <label>Pilih DP</label>
    <select id="dpType">
      <option value="10">10%</option>
      <option value="30">30%</option>
      <option value="50">50%</option>
      <option value="custom">Custom</option>
    </select>
    <input id="customDP" type="number" placeholder="Masukkan angka (%)" style="display:none">
  </div>

  <div class="summary">
    <div><span>Subtotal</span><span id="subtotal">Rp 0</span></div>
    <div id="dpRow" style="display:none">
      <span>Down Payment</span>
      <span class="green" id="dpValue">Rp 0</span>
    </div>
    <div class="total-final">
      <span>Total Setelah DP</span>
      <span id="finalTotal">Rp 0</span>
    </div>
  </div>

  <button class="btn-primary" onclick="downloadPDF()">Download Invoice PDF</button>
</div>

<!-- ========= PDF TEMPLATE (FIXED & COMPLETE) ========= -->
<div id="invoice">
  <h1>INVOICE</h1>
  <hr>

  <div class="pdf-row">
    <div>
      <strong>Kepada:</strong><br>
      <span id="pdfClient"></span>
    </div>
    <div>
      <strong>Tanggal:</strong><br>
      <span id="pdfDate"></span>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Project</th>
        <th>Harga</th>
        <th>Qty</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody id="pdfProjects"></tbody>
  </table>

  <div class="pdf-summary">
    <div>
      <div><span>Subtotal</span><strong id="pdfSubtotal"></strong></div>
      <div id="pdfDPRow">
        <span>Down Payment</span>
        <strong style="color:rgb(0, 0, 0)" id="pdfDP"></strong>
      </div>
      <div style="font-size:16px;font-weight:700;margin-top:8px">
        <span>Total Setelah DP</span>
        <strong id="pdfFinal"></strong>
      </div>
    </div>
  </div>

  <hr>
  <strong id="pdfFreelancer"></strong><br>
  No. Rekening: <span id="pdfRekening"></span><br>
  Bank: <span id="pdfBank"></span>
</div>

<script>
const projects=document.getElementById("projects");
const useDP=document.getElementById("useDP");
const dpOptions=document.getElementById("dpOptions");
const dpType=document.getElementById("dpType");
const customDP=document.getElementById("customDP");

function addProject(){
  const d=document.createElement("div");
  d.className="project";
  d.innerHTML=`
    <input placeholder="Nama Project">
    <input type="number" class="qty" value="1">
    <input type="number" placeholder="Harga">
  `;
  d.querySelectorAll("input").forEach(i=>i.addEventListener("input",updateTotal));
  projects.appendChild(d);
}
addProject();

useDP.addEventListener("change",updateTotal);
dpType.addEventListener("change",updateTotal);
customDP.addEventListener("input",updateTotal);

function updateTotal(){
  let subtotal=0;
  document.querySelectorAll(".project").forEach(p=>{
    subtotal+=(+p.children[1].value||0)*(+p.children[2].value||0);
  });

  let dp=0;
  if(useDP.checked){
    dpOptions.style.display="block";
    dpRow.style.display="flex";
    customDP.style.display=dpType.value==="custom"?"block":"none";
    const percent=dpType.value==="custom"?+customDP.value||0:+dpType.value;
    dp=subtotal*percent/100;
  }else{
    dpOptions.style.display="none";
    dpRow.style.display="none";
    customDP.style.display="none";
  }

  subtotalEl=subtotal;
  document.getElementById("subtotal").innerText="Rp "+subtotal.toLocaleString("id-ID");
  document.getElementById("dpValue").innerText="Rp "+dp.toLocaleString("id-ID");
  document.getElementById("finalTotal").innerText="Rp "+(subtotal-dp).toLocaleString("id-ID");

  return {subtotal,dp,final:subtotal-dp};
}

function updateDate(){
  const tz=document.getElementById("tz").value;
  const now=new Date();
  const utc=now.getTime()+now.getTimezoneOffset()*60000;
  const local=new Date(utc+tz*3600000);
  document.getElementById("date").innerText=local.toLocaleString("id-ID");
}
setInterval(updateDate,1000);
updateDate();

async function downloadPDF(){
  const calc=updateTotal();

  pdfClient.innerText=client.value;
  pdfFreelancer.innerText=freelancer.value;
  pdfRekening.innerText=rekening.value;
  pdfBank.innerText=bank.value;
  pdfDate.innerText=date.innerText;

  pdfProjects.innerHTML="";
  document.querySelectorAll(".project").forEach(p=>{
    const qty=+p.children[1].value||0;
    const price=+p.children[2].value||0;
    const total=qty*price;
    pdfProjects.innerHTML+=`
      <tr>
        <td>${p.children[0].value}</td>
        <td>Rp ${price.toLocaleString("id-ID")}</td>
        <td>${qty}</td>
        <td>Rp ${total.toLocaleString("id-ID")}</td>
      </tr>`;
  });

  pdfSubtotal.innerText="Rp "+calc.subtotal.toLocaleString("id-ID");
  pdfDP.innerText="Rp "+calc.dp.toLocaleString("id-ID");
  pdfDPRow.style.display=useDP.checked?"flex":"none";
  pdfFinal.innerText="Rp "+calc.final.toLocaleString("id-ID");

  const canvas=await html2canvas(invoice,{scale:2});
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF("p","mm","a4");
  const w=210;
  const h=canvas.height*w/canvas.width;
  pdf.addImage(canvas.toDataURL("image/png"),"PNG",0,0,w,h);
  pdf.save("invoice.pdf");
}
</script>

</body>
</html>
